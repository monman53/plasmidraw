<!DOCTYPE html>
<meta charset="utf-8">
<script src="https://unpkg.com/vue"></script>
<title>plasmidraw</title>

<header>
<h1>plasmidraw</h1>
<p>plasmid diagram drawer</p>
</header>

<div id='plasmid'>
    <svg width='500px' height='500px' viewBox='-1.5 -1.5 3 3'>
        <circle cx='0' cy='0' r='1' stroke='black' fill='none' stroke-width='0.01' />
        <defs>
            <clipPath id='cut-off'>
                <circle cx='0' cy='0' r='0.95' />
            </clipPath>
        </defs>
        <gene v-for='(gene, index) in genes' :gene='gene'></gene>
    </svg>

    <br>

    <!--<h3>Edit</h3>-->
    <h3>New</h3>
    <label for='from'>from</label>
    <input id='from' type='number' min='0' max='1' v-model='new_from'></input><br>
    <label for='to'>to</label>
    <input id='to' type='number' min='0' max='1' v-model='new_to'></input><br>
    <button v-on:click='addGene'>Add</button>
</div>

<script>

var plasmid = new Vue({
    el: "#plasmid", 
    data: {
        genes: [],
        id_counter: 0,
        new_from: 0.25,
        new_to: 0.5,
    },
    methods: {
        addGene: function() {
            console.log("Gene added.");
            var from = this.id_counter*0.05;
            var to = from + 0.03;
            this.genes.push({id: this.id_counter, from: this.new_from, to: this.new_to});
            this.id_counter++;
        }
    }, 
    components: {
        'gene': {
            template: '<path :d="d" fill="gray" stroke="black" stroke-width="0.01" :id="gene.id" />', 
            props: ['gene'], 
            computed: {
                d: function() {
                    var r = 1.0;
                    var from = this.gene.from;
                    var to = this.gene.to;
                    var sx =  r*Math.sin(from*2*Math.PI);
                    var sy = -r*Math.cos(from*2*Math.PI);
                    var tx =  r*Math.sin(to*2*Math.PI);
                    var ty = -r*Math.cos(to*2*Math.PI);
                    var a = from <= to ? 1 : 0;
                    var b = Math.abs(from-to) >= 0.5 ? 1 : 0;

                    var dr = 0.05;

                    var res = '';
                    //res += 'M 0 0';
                    res += `m ${sx*(1+dr)} ${sy*(1+dr)}`;
                    res += `A ${r*(1+dr)} ${r*(1+dr)} 0 ${b} ${a} ${tx*(1+dr)} ${ty*(1+dr)}`;
                    res += `L ${tx*(1-dr)} ${ty*(1-dr)}`;
                    res += `A ${r*(1-dr)} ${r*(1-dr)} 0 ${b} ${1-a} ${sx*(1-dr)} ${sy*(1-dr)}`;
                    res += `L ${sx*(1+dr)} ${sy*(1+dr)}`;
                    return res;
                    //return `M 0 0 L ${sx} ${sy} A ${r} ${r} 0 ${b} ${a} ${tx} ${ty} L 0 0`;
                }, 
            }, 
        }
    }
});
</script>

<footer>
<p>powered by Vue.js and SVG</p>
</footer>
